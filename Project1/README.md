# Проекта №1

Проект выдаётся студентам, которые (требуется выполнение всех):

1. Познакомились с github и выкладывали туда задание
2. Выполнили примерно половину от 4 частей заданий
3. Набрали 10 и более баллов за задания

## Порядок выполнения

Задания 1 и 2 проекта выполняются на СУБД - MySQL.

Вы можете установить сервер MySQL локально, чтоб работать без интернета. Но сдача заданий только способом, описанным ниже:

1. Создать пользователя на [сайте](https://unidb.ru/#/) (**Примечание:** лучше ввести понятное имя пользователя (фамилию). Также запомните обязательно пароль, если его забудете ~~минус балл~~ придётся писать мне, чтобы я сбросил его на временный)
2. Установить себе [MySQL WorkBench](https://dev.mysql.com/downloads/workbench/)
3. [Инструкция по проектированию](#инструкция-по-проектированию)
4. [И концертация кода](#конвертация-кода)
5. [Сдать задание](#порядок-сдачи-и-получения-заданий)

### Порядок сдачи и получения заданий

1. Создать **приватный** репозиторий на github (или использовать репозиторий, в который выкладывали задания раньше, только поменять на приватный) - не забудьте добавить меня в collaborators. С момента объявления, что у вас есть проект (у первых есть ещё право выбора темы) 2 недели отводится на проектирование (старые задания тоже выполняются), время начинается с вашей пары, не важно, когда вы создали репозиторий (или поменяли старый на приватный), так что в ваших интересах сделать это быстро.
2. Подождать, когда я выложу 1-ую часть проекта - проектирование БД. Инструкция в этом файле есть.
3. После выполнения в репозиторий на github выкладывайте - mwb файл - сохраненный проект mysql workbench, скрипт создания таблиц в формате sql, фото спроектированной таблицы. Назовите коммит "project1 p1", например. Чтобы я понял, что это проект и стоит посмотреть в первую очередь.
4. Это вы должны сделать в течение 1-ой недели с момента получения. Я проверяю, говорю об ошибках, которые надо устранить за следующую неделю (если их нет, то сразу получите 2-ую часть 1-го проекта).
5. После получения замечаний, недели исправлений, сдаёте задания и получаете итоговый балл за эту часть (также могут быть ещё замечания, это уже влияет на итоговый балл в отрицательную сторону, но их надо исправлять). **Проектирование идёт вместе, а не вместо основного материала. Поэтому их тоже надо выполнять в течение этих двух недель, иначе баллы за задания идти не будут.**
6. После получения итогового балла за проектирование - в ваш репозиторий добавится вторая часть проекта - запросы. **Эта часть идёт уже вместо основных запросов.** Делаете запросы и выкладываете по мере сделанного. На эту часть тоже выделяется 2 недели (а кто смог сдать проектирование сразу после 1-ой недели, то на неделю больше времени на запросы)
7. Выкладываете запросы на github, получаете за них баллы.

- **За каждый проект примерно 20 баллов**
- **Если вы получаете проект заметно позже (10 неделя и позже), то шанс заработать много баллов очень низок**
- **Срыв срока сдачи проекта отрицательно сказывается на количестве полученных баллов**
- **Бэкап базы делается раз в день ночью, поэтому если вы что-то где-то накосячили, то восстановить можно, но лучше делайте собственные бэкапы, на всякий**

## Инструкция по проектированию

MySQL Workbench [Скачать](https://dev.mysql.com/downloads/workbench/). После нажатия на Download откроется страница, где надо будет авторизоваться, но ниже есть кнопка "No thanks, just start my download" - нажите её. Удобное средства для построения EER диаграммы и генерации SQL кода. Инструкция по применению - внизу этого документа.

**Инструкция:**
Тут описано как сделать само проектирование (ERR-диаграмму):

![Главная](http://pics.sl/42a/efd/db42a528.png)

![Создание новой модели](http://pics.sl/07f/514/45148768.png)

![Добавление новой диаграммы](http://pics.sl/44b/bf9/83bf9abe.png)

На диаграмму можно добавить таблицы и прочие объекты. Но нам нужны только таблицы

![Добавление таблицы на диаграмму](http://pics.sl/27f/e9d/5b92f37e.png)

После нажатия двойным кликом на таблицу - её можно изменять. Поменять название, атрибуты, поставить первичный ключ и прочие параметры.

![Изменение таблицы](http://pics.sl/5c1/58d/dba21ee7.png)

![Изменение таблицы](http://pics.sl/d74/3aa/ea538b2a.png)

К таблице можно добавить внешний ключ.
Для этого необходимо выбрать нужный из списка слева. Нажать на ту таблицу, в которую будет добавлен новый атрибут - внешний ключ.
И после этого кликнуть на ту таблицу, из которой берём первичный ключ.
После этого ключ создан.

Отменить действией можно как и везде - ctrl+z

![Добавление внешних ключей](http://pics.sl/e6e/e84/5e6e84fc.png)

### Конвертация кода

Если вы подготовили EER-диаграмму, то можно сразу автоматически создать все таблицы.

1. Нажмите сверху Database - Syncronize model with Database.
2. В окне подключитесь к MySQL серверу. Host - unidb.ru, port: 6606, user - ваш*username*указанный при создании, password - ваш_пароль.
3. На этапе Select schemas выберите схему (по умолчанию ваша модель создаётся в mydb) - поставьте галочку и выберите эту строку. Снизу выберите название вашей базы данных (совпадает с username) и нажмите на override target. Next
4. После успешного получения всех объектов на этапе "Select Changes to Apply" у вас должна быть модель и Source (в источнике баз не должно быть, если вы не делаете эту операцию ещё раз)
5. Review DB Changes - на этом этапе скопируйте весь код в файл формата .sql - позже добавите его в репозиторий, для удобства моей проверки.
6. Если всё сделали правильно, то ошибок возникнуть не должно (бывает появляется что-то типа VISIBLE ... - вернитесь на предыдущий этап и удалите прям из кода это слово)

### Работа с таблицами

Необходимо создать подключение, как на этапе конвертации кода

![img1](./img/2019-04-11_10-35-19.png)

Указать все параметры, название подключения (оно будет сохранено), пароль тоже можно сохранить в хранилище, чтоб не вводить каждый раз

![img1](./img/2019-04-11_10-37-42.png)

Так выглядит подключение - нажмите и подключитесь (если ввели все данные правильно)

![img1](./img/2019-04-11_10-39-23.png)

Скорее всего первым делом откроется окно Administration - там, например, вы можете сделать бэкап вашей базы. А вообще работать на вкладке - Schemas.

![img1](./img/2019-04-11_10-40-23.png)

Если вы уже конвертировали данные, то увидите похожу картину (с вашими таблицами)

![img1](./img/2019-04-11_10-42-55.png)

Некоторые полезные плюшки указаны ниже.

![img1](./img/9.png)

Писать запросы - таким образом

![img1](./img/2019-04-11_11-03-09.png)

На скриншоте ниже:

1. Сделайте вашу схему активной, два раза кликнув на неё, чтобы не писать какждый раз название базы данных.
2. Выполнить полностью запрос (горячие клавиши - ctrl+enter)
3. Выполнить только часть (где находится курсор, до ближайшей `;`) (горячие клавиши - ctrl+shift+enter)
4. MySQL workbench делает некоторые подсказки

![img1](./img/10.png)

### Добавление данных

В MySQL возможен следующий синтаксис добавления:

```sql
INSERT INTO `student` (`name`, `surname`, `date_birth`, `n_group`, `score`, `city`, `address`)
VALUES ('Николай','Николаев','1999-01-01',1012,4.78,'Москва','ул. Пушкина'),
       ('Алла','Дмитриева','1998-11-29',2011,3.83,'Дубна','ул. Николаева'),
       ('Пётр','Петров','1999-12-23',4011,4.54,'Казань','ул. Чапаева, д. 12, кв. 14'),
       ('1','2','1997-12-12',3,4.22,'Дубна','');
```

Т.е. в данном примере у нас есть атрибут в таблице id, который тут не указывается (т.к. мы поставили в таблице галочку в графе AI (auto increment)). Если вы не поставили, то чтобы поменять таблицу откройте Alter Table и поставьте, примите изменения. Однако, если на эту таблицу у вас есть ссылки (внешние ключи), то нужно их убрать, а потом добавить снова.

Ну или при добавлении указываете id тоже.

Сверху, в примере, добавляется 4 записи в таблицу одновременно.
