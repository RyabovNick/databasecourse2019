# DML

## Оператор выбора SELECT

Все запросы на получение практически любого количества данных из одной или нескольких таблиц выполняются с помощью единственного предложения SELECT. Синтаксис оператора SELECT имеет следующий вид:

```sql
SELECT [ALL | DISTINCT] <список полей> | *
FROM <список таблиц>
[WHERE <условие фильтрации строк>]
[GROUP BY <условия группировки строк>]
[HAVING <условие фильтрации групп>]
[ORDER BY <условие сортировки результата запроса>]
```

Обязательными среди всех указанных параметров оператора SELECT являются параметры SELECT и FROM. Результатом выполнения оператора SELECT является набор данных (временная таблица), который затем либо передается пользователю, запросившему данные, либо используется как источник данных для другого оператора SELECT в качестве подзапроса. Представляет исторический интерес тот факт, что именно возможность включения одного предложения SELECT внутрь другого послужила мотивировкой использования прилагательного «структурированный» в названии языка SQL.

## Запросы с использованием единственной таблицы

### Выборка без использования параметра WHERE

Выборка данных без использования параметра WHERE с использованием единственной таблицы является наиболее простой формой использования оператора SELECT.

### Выборка всей информации из таблицы

```sql
SELECT список_всех_полей_таблицы | *
FROM имя_таблицы;
```

Данная форма оператора SELECT используется, когда не нужно выполнять ни горизонтальную, ни вертикальную фильтрации. Символ «\*» заменяет необходимость указания всех полей таблицы. Например:

```sql
SELECT *
FROM student;
```

### Псевдоним

Псевдонимы (alias) удобно использовать для более удобного доступа к таблицам в запросе, а также для переименования атрибутов. [Подробнее п.12](../../Tasks/README.md)

Если запрос на одну таблицу, то понятно, что псевдонимами можно принебречь, но лучше привыкать так всегда.

Примеры:

Без использования псевдонима

```sql
Select name, surname
From student
```

С использованием псевдонима таблицы

```sql
Select s.name, s.surname
From student s
```

С использованием псевдонима атрибутов

```sql
Select s.name as students_name, s.surname as n
From student s
```

Код выше сработает и без `as`, но для удобства лучше его использовать.

### Вертикальная фильтрация с указанием порядка вывода атрибутов

```sql
SELECT поле1[, поле2, …] FROM имя_таблицы;
```

В результирующий набор записей попадут данные только из указанных полей таблицы, причем в том же самом порядке, в каком они указаны в операторе SELECT. Например:

-- вывод неполной информации о студентах

```sql
SELECT id,
       Name
FROM student;
```

### Исключение дубликатов

При использовании в операторе SELECT вертикальной фильтрации строк таблицы может сложиться ситуация, когда набор записей будет включать дубликаты – записи, значения полей которых полностью совпадают. Для исключения дубликатов из результирующего набора записей используют параметр DISTINCT, который указывают сразу после ключевого слова SELECT. Например:

-- вывод различных фамилий

```sql
SELECT DISTINCT surname
FROM student;
```

### Выборка вычисляемых значений

Наравне с перечнем полей таблиц после ключевого слова SELECT можно указывать выражения, вычисляемые на основе полей таблиц, либо встроенных функций СУБД.

Обычно синонимы используются либо для именования результатов выражений, либо для замены полей таблицы более подходящими в конкретной ситуации названиями.

### Сортировка результирующего набора данных

Строки в таблицах базы данных изначально хранятся в том порядке, в каком их туда поместили. Иногда СУБД по своему усмотрению может менять внутреннюю организацию хранения данных. По этой причине никогда не стоит надеяться, что оператор SELECT вернет отсортированный набор данных, даже в том случае, если записи заносились в таблицу в соответствии с возрастанием или убыванием значений в определенных полях. Для сортировки результирующего набора данных используется параметр ORDER BY оператора SELECT. Например:

```sql
SELECT *
FROM student
ORDER BY surname,
         Name;
```

Если после параметра ORDER BY указано более одного поля, сортировка сначала осуществляется по первому полю, потом, в случае наличия одинаковых значений, по второму и т.д. В приведенном примере результирующий набор данных сначала будет отсортирован по значениям поля Name, и в том случае, если в каких-то строках имена некоторых дилеров совпадут, эти строки отдельно будут отсортированы по значению поля Procent.

По умолчанию (неявно) сортировка всегда происходит по возрастанию. Но способ сортировки можно задать явно, указав после соответствующего поля параметр ASC или DESC для сортировки по возрастанию или убыванию соответственно. Например:

```sql
SELECT *
FROM student
ORDER BY surname,
         Name DESC;
```

### Выборка с использованием параметра WHERE

Параметр WHERE служит для реализации реляционной операции горизонтальной фильтрации, то есть отбора кортежей, или строк, удовлетворяющих определенному условию. Условие может быть составлено с использованием следующих конструкций:

- операторы сравнения: =, < , > , <= , >= , <>;
- булевы операторы: AND, OR, NOT;
- оператор проверки на вхождение в множество: IN;
- оператор проверки на вхождение в диапазон: BETWEEN;
- оператор проверки на существование: EXISTS;
- оператор проверки удовлетворению шаблону (только для символьных полей): LIKE;
- операторы сравнения с NULL: IS NULL, IS NOT NULL;
- агрегатные функции: COUNT, SUM, AVG, MAX, MIN;
- константы и выражения;
- подзапросы.

Следует быть осторожными при использовании булевых операторов, поскольку существует приоритет AND над OR (сначала выполняются все операции AND и только после этого операции OR). Для получения желаемого результата WHERE условия должны быть введены в правильном порядке, который можно организовать введением скобок.

При обработке условия числа сравниваются алгебраически – отрицательные числа считаются меньшими, чем положительные, независимо от их абсолютной величины. Строки символов сравниваются в соответствии с их представлением в коде, используемом в конкретной СУБД, например, в коде ASCII. Если сравниваются две строки символов, имеющих разные длины, более короткая строка дополняется справа пробелами для того, чтобы они имели одинаковую длину перед осуществлением сравнения.

### Использование операторов сравнения

В параметре WHERE оператора SELECT для отбора нужных строк таблицы можно использовать операторы сравнения = (равно), <> (не равно), < (меньше), <= (меньше или равно), > (больше), > = (больше или равно), которые могут предваряться оператором NOT, создавая, например, отношения «не меньше» и «не больше».

```sql
SELECT Name
FROM hobby
WHERE Risk <=5;
```

-- то же самое с применением оператора NOT

```sql
SELECT Name
FROM hobby
WHERE NOT Risk >5;
```

Возможность использования нескольких условий, соединенных логическими операторами AND, OR, AND NOT и OR NOT, позволяет осуществить более детальный отбор строк.

### Использование BETWEEN

С помощью оператора BETWEEN можно отобрать строки, в которых значение какого-либо столбца находятся в заданном диапазоне.

При помощи сочетания операторов NOT и BETWEEN можно отобрать строки, в которых значение какого-либо столбца не находится в заданном диапазоне. Например:

```sql
SELECT Name
FROM hobby
WHERE Risk NOT BETWEEN 5 AND 8;
```

Использование оператора BETWEEN возможно не только по отношению к полям числового типа, он применим также к полям строкового типа и датам.

### Использование IN

Оператор IN используется для проверки вхождения значения какого-либо столбца в множество. Например:

```sql
SELECT n_group
FROM student
WHERE n_group IN (11,
               12,
               13);
```

Рассмотренная форма IN является в действительности просто краткой записью последовательности отдельных сравнений, соединенных операторами OR.

В сочетании с оператором IN можно также использовать NOT для отбора строк, в которых значение какого-либо столбца наоборот не входит в множество. Например:

```sql
SELECT n_group
FROM student
WHERE n_group NOT IN (11,
                   12,
                   13);
```

### Использование LIKE

Оператор LIKE используется для отбора строк, в которых значение какого-либо удовлетворяет определенному шаблону. Данный оператор применяется только к символьным полям. Обычная форма *имя*столбца* LIKE *текстовая*константа* для столбца символьного типа позволяет отыскать все значения указанного столбца, соответствующие шаблону, заданному *текстовой*константой\_. Символы этой константы интерпретируются следующим образом:

- символ \_ (подчеркивание) – заменяет любой одиночный символ;
- символ % (процент) – заменяет любую последовательность из любого количества символов, в том числе нулевого;
- все другие символы означают просто сами себя.

Примеры:

-- отбор информации о студентах,
-- фамилии которых начинаются с заглавной буквы «О»
-- и заканчивающихся на «ов»

```sql
SELECT *
FROM student
WHERE surname LIKE 'O%ов';
```

Оператор LIKE также можно сочетать с NOT для получения строк, значения определенных столбцов которых не удовлетворяют указанному шаблону.

## Сравнение с неопределенным значением NULL

Для отбора строк таблицы, значения атрибутов которых необходимо сравнивать на равенство или неравенство с NULL-значением, используют операторы IS NULL и IS NOT NULL соответственно. Использование операторов «=» или «<>» не вызовет ошибки, но и не позволит достичь необходимого результата. Например:

-- отбор студентов, у которых не указан адресс

```sql
SELECT *
FROM student
WHERE address IS NULL;
```

В СУБД ORACLE есть некоторые отличия реализации NULL-значений по сравнению со стандартом ANSI SQL. Согласно ANSI все типы данных должны поддерживать неопределенные или NULL-значения. СУБД ORACLE в полной мере поддерживает это правило для всех типов, за исключением символьных. Для любых символьных данных пустая строка интерпретируется как NULL, например два оператора ORACLE SQL полностью идентичны и вставят в поле Comments значения NULL, а не пустые строки:

В ORACLE вообще нельзя вставить пустую строку – она всегда будет рассматриваться как NULL.

[Больше информации по возможностям Select можно найти тут](../5_Queries)

## INSERT

Запросы на добавление данных в таблицы выглядят следующим образом:

```sql
INSERT INTO table_name (column1, column2, column3, ...)
VALUES (value1, value2, value3, ...);
```

В данном случае необходимо перечислить названия атрибутов, а также значение.

Если вы добавляете значения всех атрибутов таблицы, то можно не указывать названия атрибутов:

```sql
INSERT INTO table_name
VALUES (value1, value2, value3, ...);
```

в этом случае необходимо указывать значения в таком же порядке, как атрибуты хранятся в таблице. Будьте внимательны. В oracle, на какой месте бы не хранился первичный ключ, в таблице при просмотре данных он будет первый. Но добавляя надо будет указать его именно на том месте, где вы его создавали. **Лучше всегда указывайте первичный(-ые) ключ 1-ым**

Пример:

```sql
INSERT INTO student (id, name, surname)
VALUES (5, 'Иван', 'Иванов');
```

Пример выше включает и добавление первичного ключа, но чаще (и мы так будем делать) используется автоматическа генерация первичного ключа, поэтому в основном запросы добавления у вас будут выглядеть следующим образом

```sql
INSERT INTO student (name, surname)
VALUES ('Иван', 'Иванов');
```

Из-за этого практически всегда добавление в таблицу без конкретного указания атрибутов невозможно (т.к. всегда исключаем первичный ключ).

Обратите внимание, что если это число, то можно не писать кавычки. Остальные типы данных пишутся в кавычках.

Также имеется возможность добавить данные в таблицу из другой таблицы

```sql
INSERT INTO table2
SELECT * FROM table1
WHERE condition;
```

В `Select` можно использовать что угодно, писать какие угодно условия. Главное - количество атрибутов в table2 должно совпадать с количеством атрибутов, которое возвращает `Select`. Condition - различные условия отбора строк.

Пример:

```sql
INSERT INTO table2 (column1, column2, column3, ...)
SELECT column1, column2, column3, ...
FROM table1
WHERE condition;
```

## UPDATE

`Update` запросы используются для изменения существующих данных в таблице.

**Будьте внимательны! Если вы не добавите `WHERE` в запрос на обновление данных, то обновятся все данные в таблице. Либо, если условия в `WHERE` написаны неправильно.**

```sql
UPDATE table_name
SET column1 = value1, column2 = value2, ...
WHERE condition;
```

Пример:

```sql
UPDATE student
SET Name = 'Николай', Address = 'Dubna'
WHERE id = 3;
```

Ещё раз. Например, в запросе на обновление данных, если вам надо поменять только одну запись, то используйте первичный ключ. Что-то уникальное.

Если вы напишите такой запрос:

```sql
UPDATE student
SET score = 5
WHERE Name = 'Николай' and Address = 'Dubna';
```

То запрос поменяет атрибут `score` на 5 для всех Николаев из города Дубна.

## DELETE

Запрос `Delete` удаляет существующие строки в таблице

```sql
DELETE
FROM table_name
WHERE condition;
```

**Как и с запросом на обновление, надо быть внимательным. Если вы не напишите `WHERE` или напишите его неправильно и под это условие подойдут, например, все строки в таблице, то они все будут удалены**

Если вы хотите удалить из таблицы всех студентов с заданными именем, то запрос будет выглядеть так:

```sql
DELETE
FROM student
WHERE name = 'Николай';
```

Если вам надо удалить конкретного студента, то, опять же, используйте уникальные значения. В нашем случае в таблице `student` это номер зачётки.

```sql
DELETE
FROM student
WHERE id = 3;
```

Если вам надо удалить все данные из таблицы, то:

```sql
DELETE
FROM student;
```
